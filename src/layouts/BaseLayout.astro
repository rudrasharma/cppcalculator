---
/**
 * Base Layout Component
 * Main layout wrapper for calculator pages with navigation, footer, and SEO
 */

import '../styles/global.css';
import ContactButton from '../components/shared/ui/ContactButton.jsx';

interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;
const currentPath = Astro.url.pathname;
const canonicalURL = new URL(Astro.url.pathname, Astro.site || Astro.url.origin);

// --- UPDATE THIS SECTION ---
const TABS = [
  { id: 'cpp', href: '/cpp-oas-calculator', label: 'CPP & OAS', color: 'text-indigo-600', bg: 'bg-indigo-50' },
  { id: 'parental', href: '/parental-leave-calculator', label: 'Mat. Leave', color: 'text-rose-600', bg: 'bg-rose-50' },
  { id: 'ccb', href: '/child-benefit-calculator', label: 'Family Cash', color: 'text-emerald-600', bg: 'bg-emerald-50' },
  { id: 'budget', href: '/grocery-inflation-calculator', label: 'Budget Def.', color: 'text-amber-600', bg: 'bg-amber-50' },
  // ADD THIS LINE:
  { id: 'mortgage', href: '/mortgage-break-calculator', label: 'Mortgage', color: 'text-sky-600', bg: 'bg-sky-50' },
];
// ---------------------------

const schema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": title,
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "Web",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "CAD"
  },
  "description": description
};
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
    <title>{title} | LoonieFi</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    
    {/* Open Graph Tags */}
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content="/android-chrome-192x192.png" />
    
    {/* Twitter Card Tags */}
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />

    {/* Schema Markup */}
    <script type="application/ld+json" set:html={JSON.stringify(schema)} />

    {/* Google Analytics 4 (GA4) */}
    <script 
      async 
      src="https://www.googletagmanager.com/gtag/js?id=G-DS4P8VC6WQ"
      is:inline
    ></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DS4P8VC6WQ');
    </script>
  </head>

  <body class="bg-slate-50 text-slate-800 font-sans min-h-screen flex flex-col antialiased selection:bg-indigo-100 selection:text-indigo-900">
    
    {/* --- SHARED HEADER --- */}
    <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50" role="navigation" aria-label="Main navigation">
      <div class="max-w-6xl mx-auto px-6 h-16 flex items-center justify-between">
        <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity" aria-label="LoonieFi homepage">
          <img src="/android-chrome-192x192.png" alt="LoonieFi Logo" class="h-8 w-8 rounded-full shadow-sm" width="32" height="32" />
          <div class="text-lg font-bold tracking-tight">
            <span className="text-amber-500">Loonie</span><span class="text-slate-900">Fi</span>
          </div>
        </a>

        {/* DESKTOP TABS */}
        <div class="hidden md:flex gap-1 bg-slate-100/50 p-1 rounded-xl border border-slate-200/50" role="tablist" aria-label="Calculator navigation">
          {TABS.map((tab) => (
            <a 
              href={tab.href}
              role="tab"
              aria-selected={currentPath === tab.href ? 'true' : 'false'}
              class={`px-4 py-2 rounded-lg text-sm font-bold transition-all flex items-center gap-2 ${
                currentPath === tab.href 
                ? 'bg-white text-slate-900 shadow-sm ring-1 ring-black/5' 
                : 'text-slate-500 hover:text-slate-700 hover:bg-slate-200/50'
              }`}
            >
              {tab.label}
            </a>
          ))}
        </div>
      </div>
    </nav>
    
    {/* --- MAIN CONTENT SLOT --- */}
    <main class="flex-grow flex flex-col">
      <slot />
    </main>

    {/* --- SHARED FOOTER --- */}
    <footer class="bg-slate-50 border-t border-slate-200 pb-32 md:pb-20 pt-10 mt-auto">
      <div class="max-w-5xl mx-auto px-6 text-center">
        
        {/* FOOTER LINKS */}
        <nav class="flex flex-wrap justify-center items-center gap-x-6 gap-y-2 mb-8 font-medium text-sm" aria-label="Footer navigation">
          
          {/* 1. ABOUT US LINK */}
          <a href="/about" class="text-slate-500 hover:text-indigo-600 transition-colors">About Us</a>
          <span class="text-slate-300 hidden sm:inline" aria-hidden="true">•</span>

          <a href="/blog" class="text-indigo-600 hover:text-indigo-800 transition-colors flex items-center gap-2 group">
            <span class="bg-indigo-100 text-indigo-700 p-1 rounded group-hover:bg-indigo-200 transition-colors" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
            </span>
            Guides & Blog
          </a>

          <span class="text-slate-300 hidden sm:inline" aria-hidden="true">•</span>

          {/* 2. SHARE LINK BUTTON */}
          <button 
            id="share-btn" 
            class="text-slate-500 hover:text-indigo-600 transition-colors flex items-center gap-1"
            aria-label="Copy page URL to clipboard"
          >
            Share Link
            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
          </button>
          <span id="share-toast" class="hidden text-xs text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full animate-fade-in" role="status" aria-live="polite">Copied!</span>

          <span class="text-slate-300 hidden sm:inline" aria-hidden="true">•</span>

          <ContactButton client:visible />
        </nav>

        {/* DISCLAIMER SECTION */}
        <div class="max-w-2xl mx-auto mb-6">
          <p class="text-[11px] leading-relaxed text-slate-500">
            <strong>Disclaimer:</strong> This tool provides estimates for informational purposes only and does not constitute financial, legal, or tax advice. While we strive for accuracy using official formulas, your actual government benefits (CPP, OAS, CCB) may vary based on official assessments. Please consult a professional financial planner or Service Canada for your specific situation.
          </p>
        </div>

        {/* COPYRIGHT */}
        <div class="flex flex-col gap-2 border-t border-slate-100 pt-6">
          <p class="text-xs text-slate-500">
            © {new Date().getFullYear()} LoonieFi. All rights reserved.
          </p>
          <p class="text-[10px] text-slate-300 uppercase tracking-wider">
            Made with <span class="text-rose-400" aria-label="love">♥</span> in Waterloo, ON (v1.2)
          </p>
        </div>
      </div>
    </footer>

    {/* SCRIPT FOR SHARE BUTTON */}
    <script is:inline>
      const shareBtn = document.getElementById('share-btn');
      const shareToast = document.getElementById('share-toast');

      if (shareBtn) {
        shareBtn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(window.location.href);
            // Show "Copied!" toast
            if (shareToast) {
              shareToast.classList.remove('hidden');
              shareToast.setAttribute('aria-live', 'polite');
              setTimeout(() => {
                shareToast.classList.add('hidden');
              }, 2000);
            }
          } catch (err) {
            console.error('Failed to copy: ', err);
          }
        });
      }
    </script>

  </body>
</html>