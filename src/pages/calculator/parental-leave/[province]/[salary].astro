---
// src/pages/calculator/parental-leave/[province]/[salary].astro
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import ParentalLeave from '../../../../components/ParentalLeave.jsx';
import { PROVINCES, SALARIES } from '../../../../data/seo-scenarios';

// IMPORTANT: This line fixes the "NaN" / Undefined data issue
export const prerender = true;

export async function getStaticPaths() {
  const paths = [];

  PROVINCES.forEach((prov) => {
    SALARIES.forEach((salary) => {
      paths.push({
        params: { 
          province: prov.slug, 
          salary: salary.toString() 
        },
        props: { 
          provinceCode: prov.code, 
          provinceName: prov.name, 
          salaryVal: salary 
        },
      });
    });
  });

  return paths;
}

const { provinceCode, provinceName, salaryVal } = Astro.props;

const salaryFormatted = new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD', maximumFractionDigits: 0 }).format(salaryVal);
const title = `Parental Leave Calculator for ${provinceName} (${salaryFormatted} Salary) | 2025 Guide`;
const description = `Expecting a baby in ${provinceName}? See exactly how much maternity and parental leave you will receive with a ${salaryFormatted} salary. Updated for 2025 rules.`;
---

<BaseLayout title={title} description={description}>
  
  <section class="py-12 px-4 max-w-5xl mx-auto">
    <h1 class="text-3xl md:text-4xl font-black text-slate-900 mb-4 text-center">
      Parental Leave Benefits in <span class="text-rose-600">{provinceName}</span>
    </h1>
    <p class="text-center text-slate-600 mb-8 max-w-2xl mx-auto">
      Based on an annual income of <strong>{salaryFormatted}</strong>, here is your estimated bi-weekly take-home pay during maternity and parental leave.
    </p>

    <ParentalLeave 
      client:load 
      initialProvince={provinceCode} 
      initialSalary={salaryVal} 
    />

    <div class="prose prose-slate mx-auto mt-16 bg-white p-8 rounded-3xl border border-slate-100 shadow-sm">
      <h2>How Parental Leave Works in {provinceName}</h2>
      <p>
        Residents of <strong>{provinceName}</strong> are subject to {provinceCode === 'QC' ? 'QPIP (Quebec Parental Insurance Plan)' : 'Federal EI (Employment Insurance)'} rules. 
      </p>
      <p>
        With an income of <strong>{salaryFormatted}</strong>, you {salaryVal > 66600 && provinceCode !== 'QC' ? 'exceed the 2025 maximum insurable earnings threshold ($66,600). This means your benefits will be capped at the maximum weekly amount.' : 'are below the maximum threshold, so your benefits are calculated as a percentage of your full income.'}
      </p>
      <ul>
        <li><strong>Standard Plan:</strong> 55% of your income (up to the cap) for 12 months.</li>
        <li><strong>Extended Plan:</strong> 33% of your income (up to the cap) for 18 months.</li>
      </ul>
    </div>

  </section>
</BaseLayout>