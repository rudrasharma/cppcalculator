---
// src/pages/calculator/cpp-oas/[scenario].astro
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Calculator from '../../../features/retirement/components/index.jsx';
// NEW: Import Breadcrumbs
import Breadcrumbs from '../../../components/shared/Breadcrumbs.astro';
import { CPP_SCENARIOS } from '../../../data/seo-scenarios';

export const prerender = true;

export async function getStaticPaths() {
  return CPP_SCENARIOS.map((scenario) => ({
    params: { scenario: scenario.slug },
    props: { scenario },
  }));
}

const { scenario } = Astro.props;

const incomeFormatted = new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD', maximumFractionDigits: 0 }).format(parseInt(scenario.income));
const title = `${scenario.label} - CPP & OAS Calculator 2025 | LoonieFi`;
const description = `${scenario.desc} Based on ${scenario.years} years of residence and avg annual earnings of ${incomeFormatted}. Calculate your retirement benefits with this pre-filled scenario.`;
const canonicalURL = new URL(`/calculator/cpp-oas/${scenario.slug}`, Astro.site || Astro.url.origin);

// NEW: Define Breadcrumb Path
const breadcrumbPath = [
  { label: 'CPP & OAS', href: '/cpp-oas-calculator' },
  { label: scenario.label, href: Astro.url.pathname }
];

// Schema.org structured data for calculator page
const calculatorSchema = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": title,
  "description": description,
  "url": canonicalURL.toString(),
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "Web",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "CAD"
  },
  "featureList": [
    "CPP calculation",
    "OAS calculation",
    "GIS estimation",
    "Retirement age adjustment",
    "Enhanced CPP Tier 2"
  ]
};
---

<BaseLayout title={title} description={description}>
  <script type="application/ld+json" set:html={JSON.stringify(calculatorSchema)} />
  
  <main>
    <section class="py-12 px-4 max-w-6xl mx-auto">
      
    {/* NEW: Breadcrumbs Component */}
    <Breadcrumbs crumbs={breadcrumbPath} />

    <div class="text-center mb-10">
        <h1 class="text-3xl md:text-4xl font-black text-slate-900 mb-4">
            {scenario.label}
        </h1>
        <p class="text-lg text-slate-600 max-w-2xl mx-auto">
            {scenario.desc}
        </p>
    </div>

    <Calculator 
      client:load 
      initialRetirementAge={scenario.age}
      initialYearsInCanada={scenario.years}
      initialIncome={scenario.income}
      initialMaritalStatus={scenario.married}
      initialSpouseIncome={scenario.spouseIncome || ''}
      initialChildCount={scenario.childCount || 0}
      initialDob="1960-01-01" 
    />

    <div class="prose prose-slate mx-auto mt-16 bg-white p-8 rounded-3xl border border-slate-100 shadow-sm">
      <h2>Analysis of this Scenario</h2>
      <p>
        This calculation is based on a specific set of assumptions to help you estimate your future government benefits.
      </p>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 my-8">
          <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
            <h3 class="text-sm font-black uppercase text-slate-400 tracking-widest mb-2 mt-0">Key Inputs</h3>
            <ul class="text-sm space-y-2 mb-0">
                <li><strong>Retirement Age:</strong> {scenario.age}</li>
                <li><strong>Avg Earnings:</strong> {incomeFormatted}</li>
                <li><strong>Years in Canada:</strong> {scenario.years}</li>
                <li><strong>Status:</strong> {scenario.married ? 'Married/Common-Law' : 'Single'}</li>
            </ul>
          </div>

          <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
             <h3 class="text-sm font-black uppercase text-indigo-400 tracking-widest mb-2 mt-0">Why this matters</h3>
             <p class="text-sm text-indigo-900 mb-0">
                {scenario.age < 65 && "You are choosing to take CPP early. This results in a permanent reduction of 0.6% for every month before age 65 (up to 36%)."}
                {scenario.age > 65 && "You are deferring your pension. This results in a permanent increase of 0.7% for every month after age 65 (up to 42%)."}
                {scenario.years < 40 && `You have partial OAS eligibility. You will receive ${scenario.years}/40ths of the maximum Old Age Security pension.`}
                {scenario.income === '20000' && "With this income level, you likely qualify for the Guaranteed Income Supplement (GIS). The calculator above includes this estimation."}
                {scenario.childCount > 0 && "The Child Rearing Dropout provision allows you to exclude low-earning years while raising young children, protecting your average."}
             </p>
          </div>
      </div>
    </div>
    </section>
  </main>
</BaseLayout>